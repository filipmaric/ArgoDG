!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ComplexGeom=e():t.ComplexGeom=e()}(self,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CP1:()=>c,Circline:()=>_,Complex:()=>i,ComplexMatrix2x2:()=>l,Moebius:()=>d});class i{constructor(t,e){this._re=t,this._im=e}static of_real(t){return new i(t,0)}static of_imag(t){return new i(0,t)}static of_xy(t,e){return new i(t,e)}static of_polar(t,e){return new i(t*Math.cos(e),t*Math.sin(e))}static get zero(){return r}static get one(){return s}static get minus_one(){return n}static get i(){return o}static get minus_i(){return u}clone(){return new i(this.re(),this.im())}re(){return this._re}x(){return this.re()}im(){return this._im}y(){return this.im()}coords(){return[this.re(),this.im()]}static EPS=1e-8;is_zero(t){return t||(t=i.EPS),this.norm2()<t*t}eq(t,e){return this.sub(t).is_zero(e)}is_real(t){return t||(t=i.EPS),Math.abs(this.im())<t}is_imag(t){return t||(t=i.EPS),Math.abs(this.re())<t}is_inf(){return!1}to_complex(){return this}add(t){return new i(this.re()+t.re(),this.im()+t.im())}uminus(){return this.scale(-1)}sub(t){return this.add(t.uminus())}mult(t){return"number"==typeof t?this.scale(t):new i(this.re()*t.re()-this.im()*t.im(),this.re()*t.im()+this.im()*t.re())}scale(t){return new i(t*this.re(),t*this.im())}div(t){return this.mult(t.reciprocal())}norm(){return Math.sqrt(this.norm2())}norm2(){return this.re()*this.re()+this.im()*this.im()}arg(){return Math.atan2(this.im(),this.re())}sgn(){return this.scale(1/this.norm())}cnj(){return new i(this.re(),-this.im())}reciprocal(){return this.cnj().scale(1/this.norm2())}static cnj_mix(t,e){return t.cnj().mult(e).add(e.cnj().mult(t))}static scalprod(t,e){return i.cnj_mix(t,e).scale(.5).re()}}const r=new i(0,0),s=new i(1,0),n=new i(-1,0),o=new i(0,1),u=new i(0,-1);class c{constructor(t,e,r){e||(e=i.one),this.z1=t,this.z2=e,(void 0===r||r)&&this.normalize()}normalize(){this.z2.is_zero()?this.z1.is_zero()||(this.z1=i.one,this.z2=i.zero):(this.z1=this.z1.div(this.z2),this.z2=i.one)}is_valid(t){return!this.z1.is_zero(t)||!this.z2.is_zero(t)}is_zero(t){return this.z1.is_zero(t)}is_inf(t){return this.z2.is_zero(t)}static of_complex(t){return new c(t)}static of_real(t){return c.of_complex(i.of_real(t))}static of_xy(t,e){return c.of_complex(new i(t,e))}static get inf(){return m}static get zero(){return a}static get one(){return h}to_complex(){return this.z1.div(this.z2)}coords(){return this.is_inf()?null:this.to_complex().coords()}add(t){return this.z2.is_zero()&&t.z2.is_zero()?c.inf:new c(this.z1.mult(t.z2).add(t.z1.mult(this.z2)),this.z2.mult(t.z2))}uminus(){return new c(this.z1.uminus(),this.z2)}sub(t){return this.add(t.uminus())}mult(t){return this.z1.is_zero()&&t.z2.is_zero()||t.z1.is_zero()&&this.z2.is_zero()?c.one:new c(this.z1.mult(t.z1),this.z2.mult(t.z2))}reciprocal(){return new c(this.z2,this.z1)}div(t){return this.mult(t.reciprocal())}cnj(){return new c(this.z1.cnj(),this.z2.cnj())}inversion(){return this.reciprocal().cnj()}eq(t,e){return t instanceof c||(t=t.cp1()),this.normalize(),t.normalize(),this.is_inf()?t.is_inf():t.is_inf()?this.is_inf():this.sub(t).is_zero(e)}clone(){return new c(this.z1.clone(),this.z2.clone())}static ratio(t,e,i){return t.sub(e).div(t.sub(i))}static cross_ratio(t,e,i,r){const s=t.z1.mult(e.z2).sub(e.z1.mult(t.z2)),n=i.z1.mult(r.z2).sub(r.z1.mult(i.z2)),o=t.z1.mult(r.z2).sub(r.z1.mult(t.z2)),u=i.z1.mult(e.z2).sub(e.z1.mult(i.z2));return s.mult(n).is_zero()&&o.mult(u).is_zero()?c.one:new c(s.mult(n),o.mult(u))}vec_mult(t){return this.z1.mult(t.z1).add(this.z2.mult(t.z2))}}const m=new c(i.one,i.zero),a=c.of_real(0),h=c.of_real(1);i.prototype.cp1=function(){return c.of_complex(this)};class l{constructor(t,e,i,r){this.A=t,this.B=e,this.C=i,this.D=r}static zero(){return new l(i.zero,i.zero,i.zero,i.zero)}static eye(){return new l(i.one,i.zero,i.zero,i.one)}cnj(){return new l(this.A.cnj(),this.B.cnj(),this.C.cnj(),this.D.cnj())}transpose(){return new l(this.A,this.C,this.B,this.D)}adj(){return this.cnj().transpose()}det(){return this.A.mult(this.D).sub(this.B.mult(this.C))}inv(){return this._inv||(this._inv=new l(this.D,this.B.uminus(),this.C.uminus(),this.A).multC(this.det().reciprocal())),this._inv}qr(){if(null==this._Q||null==this._R){const t=this.C.cnj(),e=this.A.cnj(),i=Math.sqrt(t.norm2()+e.norm2()),r=e.scale(1/i),s=t.scale(1/i),n=new l(r,s,s.cnj().uminus(),r.cnj());this._Q=n.adj(),this._R=n.multM(this)}return[this._Q,this._R]}eq(t){return this.A.eq(t.A)&&this.B.eq(t.B)&&this.C.eq(t.C)&&this.D.eq(t.D)}is_hermitean(){return this.eq(this.adj())}is_zero(){return this.eq(l.zero())}multC(t){return new l(this.A.mult(t),this.B.mult(t),this.C.mult(t),this.D.mult(t))}multCP1(t,e){return new c(this.A.mult(t.z1).add(this.B.mult(t.z2)),this.C.mult(t.z1).add(this.D.mult(t.z2)),e)}multInvCP1(t){const[e,i]=this.qr(),r=e.adj().multCP1(t),s=r.z2.div(i.D),n=r.z1.sub(i.B.mult(s)).div(i.A);return new c(n,s)}multM(t){return new l(this.A.mult(t.A).add(this.B.mult(t.C)),this.A.mult(t.B).add(this.B.mult(t.D)),this.C.mult(t.A).add(this.D.mult(t.C)),this.C.mult(t.B).add(this.D.mult(t.D)))}congruence(t){return t.adj().multM(this.multM(t))}}class _{constructor(t,e,i,r){this.H=arguments[0]instanceof l?arguments[0]:new l(t,e,i,r),this.normalize()}normalize(){this.H=_.normalizeOriented(this.H),this.H_unoriented=_.normalizeUnoriented(this.H)}static normalizeUnoriented(t){if(t.A.is_zero()){const e=t.B.arg();return 0<=e&&e<Math.PI?t.multC(1/t.B.norm()):t.multC(-1/t.B.norm())}return t.multC(t.A.reciprocal())}static normalizeOriented(t){return t.A.is_zero()?t.multC(1/t.B.norm()):t.multC(1/t.A.norm())}static mk_circle(t,e){return new _(i.one,t.uminus(),t.cnj().uminus(),t.mult(t.cnj()).sub(i.of_real(e*e)))}static mk_line(t,e){const r=e.sub(t).mult(i.i);return new _(i.zero,r,r.cnj(),i.cnj_mix(r.uminus(),t))}static mk_poincare_line(t,e){const r=i.i.mult(t.mult(e.cnj()).sub(e.mult(t.cnj()))),s=i.i.mult(e.scale(t.norm2()+1).sub(t.scale(e.norm2()+1)));return new _(r,s,s.cnj(),r)}static mk_poincare_circle(t,e){const i=t.scale(1/((1-t.norm2())*(Math.cosh(e)-1)/2+1)),r=(1-t.norm2())*Math.sinh(e)/((1-t.norm2())*(Math.cosh(e)-1)+2);return _.mk_circle(i,r)}static mk_circline3(t,e,i){return t instanceof c||(t=t.cp1()),e instanceof c||(e=e.cp1()),i instanceof c||(i=i.cp1()),d.moebius_01inf(t,e,i).inv().moebius_circline(_.x_axis())}static unit_circle(){return new _(i.one,i.zero,i.zero,i.minus_one)}static x_axis(){return new _(i.zero,i.i,i.minus_i,i.zero)}static y_axis(){return new _(i.zero,i.one,i.one,i.zero)}is_line(){return this.H.A.is_zero()}is_circle(){return!this.is_line()}circle_center(){return this.H.B.uminus().div(this.H.A)}circle_radius(){return Math.sqrt(this.H.B.mult(this.H.C).sub(this.H.A.mult(this.H.D)).div(this.H.A.mult(this.H.A)).re())}line_points(){const t=this.H.D.mult(this.H.B).uminus().div(this.H.B.mult(this.H.C).scale(2)),e=t.add(i.i.mult((this.H.B.arg()>0?this.H.B.uminus():this.H.B).sgn()));return[t,e]}static EPS=1e-12;quad_form(t){return t instanceof c||(t=t.cp1()),t.cnj().vec_mult(this.H.multCP1(t,!1)).re()}on_circline(t,e){return e||(e=_.EPS),Math.abs(this.quad_form(t))<e}in_disc(t,e){return e||(e=_.EPS),this.quad_form(t)<-e}static cross_ratio(t,e,i,r){return e instanceof c||(e=e.cp1()),t instanceof c||(t=t.cp1()),r instanceof c||(r=r.cp1()),i instanceof c||(i=i.cp1()),c.cross_ratio(t,e,i,r)}static same_circline(t,e,i,r,s){s||(s=_.EPS);const n=_.cross_ratio(t,e,i,r);return n.is_inf()||n.to_complex().is_real(s)}static same_arc(t,e,i,r,s){s||(s=_.EPS);const n=_.cross_ratio(t,e,i,r);return!n.is_inf()&&n.to_complex().is_real(s)&&n.to_complex().re()>=s}static other_arc(t,e,i,r,s){s||(s=_.EPS);const n=_.cross_ratio(t,e,i,r);return!n.is_inf()&&n.to_complex().is_real(s)&&n.to_complex().re()<-s}static between(t,e,i,r){return _.other_arc(c.inf,t,e,i,r)}static collinear(t,e,i,r){return _.same_circline(t,e,i,c.inf,r)}static same_side(t,e,i,r){return _.collinear(t,e,i,r)&&!_.between(t,i,e,r)}static h_between(t,e,i,r){return e instanceof c||(e=e.cp1()),z.in_disc(e,r)&&_.other_arc(e,t,e.inversion(),i,r)}static cosAngle(t,e){return-(i=t.H,r=e.H,i.A.mult(r.D).add(r.A.mult(i.D)).sub(i.B.mult(r.C)).sub(r.B.mult(i.C))).re()/(2*Math.sqrt(t.H.det().re()*e.H.det().re()));var i,r}three_points(){if(!this._three_points)if(this.is_line()){const[t,e]=this.line_points();this._three_points=[t,e,t.add(e.sub(t).scale(2))]}else{const t=this.circle_center(),e=this.circle_radius();this._three_points=[t.add(i.of_real(e)),t.add(i.of_real(-e)),t.add(i.of_imag(e))]}return this._three_points}random_point(){const[t,e,i]=this.three_points().map((t=>c.of_complex(t))),r=d.moebius_01inf(t,e,i),s=Math.floor(3*Math.random());let n;return n=0==s?Math.random():1==s?1/Math.random():1-1/Math.random(),r.inv().moebius_pt(c.of_real(n))}random_point_in_disc(t){const[e,i]=this.intersect(t,!0),[r,s,n]=this.three_points().map((t=>c.of_complex(t))),o=d.moebius_01inf(r,s,n),[u,m]=[e,i].map((t=>o.moebius_pt(t).to_complex().re())).sort();let a,h=0;do{let t;if(Math.random()<.5)t=u+Math.random()*(m-u);else{const e=Math.floor(5*Math.random()),i=Math.pow(10,e)*Math.random();t=Math.random()<.5?u-i:m+i}a=o.inv().moebius_pt(c.of_real(t)),h++}while(!t.in_disc(a)&&h<100);return a}moebius_to_x_axis(){if(!this._moebius_to_x_axis){const[t,e,i]=this.three_points().map((t=>c.of_complex(t)));this._moebius_to_x_axis=d.moebius_01inf(t,e,i)}return this._moebius_to_x_axis}intersect(t,e){const r=this.moebius_to_x_axis(),s=r.moebius_circline(t),[n,o,u]=[s.H.A,s.H.B,s.H.D];let m,a;if(n.is_zero())return m=c.inf,o.is_imag()?[m,m]:(a=c.of_real(-u.re()/(2*o.re())),[m,a].map((t=>r.moebius_inv_pt(t))));{const t=o.re()*o.re()-n.re()*u.re();if(t<0){if(e){const e=Math.sqrt(-t),[s,u]=[new i(-o.re()/n.re(),+e/n.re()),new i(-o.re()/n.re(),-e/n.re())];return[s,u].map((t=>r.moebius_inv_pt(c.of_complex(t))))}return[]}{const e=Math.sqrt(t),[i,s]=[(-o.re()+e)/n.re(),(-o.re()-e)/n.re()];return[i,s].map((t=>r.moebius_inv_pt(c.of_real(t))))}}}transform(t){let e=this.three_points();return e.some((t=>isNaN(t.re())))?this:(e=e.map((e=>{const[r,s]=t(e.re(),e.im());return c.of_complex(new i(r,s))})),_.mk_circline3(...e))}eq(t){return this.H_unoriented.eq(t.H_unoriented)}}const z=_.unit_circle();class d{constructor(t,e,i,r){1==arguments.length&&t instanceof l?this.construct(t.A,t.B,t.C,t.D):this.construct(t,e,i,r)}construct(t,e,i,r){if(t.is_zero()){const s=e.norm();t=t.scale(1/s),e=e.scale(1/s),i=i.scale(1/s),r=r.scale(1/s)}else e=e.div(t),i=i.div(t),r=r.div(t),t=t.div(t);this.M=new l(t,e,i,r)}moebius_pt(t){return t instanceof c||(t=t.cp1()),this.M.multCP1(t)}moebius_inv_pt(t){return t instanceof c||(t=t.cp1()),this.M.multInvCP1(t)}moebius_circline(t){return new _(t.H.congruence(this.M.inv()))}static id(){return new d(l.eye())}inv(){return new d(this.M.inv())}comp(t){return new d(this.M.multM(t.M))}static moebius_01inf(t,e,i){const r=e.z1.mult(i.z2).sub(i.z1.mult(e.z2)),s=e.z1.mult(t.z2).sub(t.z1.mult(e.z2));return t.z1.mult(i.z2).sub(i.z1.mult(t.z2)),new d(t.z2.mult(r),t.z1.mult(r).uminus(),i.z2.mult(s),i.z1.mult(s).uminus())}}return e})()));