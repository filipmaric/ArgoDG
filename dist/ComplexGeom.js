!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ComplexGeom=e():t.ComplexGeom=e()}(self,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CP1:()=>c,Circline:()=>_,Complex:()=>i,ComplexMatrix2x2:()=>l,Moebius:()=>d});class i{constructor(t,e){this._re=t,this._im=e}static of_real(t){return new i(t,0)}static of_imag(t){return new i(0,t)}static of_polar(t,e){return new i(t*Math.cos(e),t*Math.sin(e))}static get zero(){return s}static get one(){return r}static get minus_one(){return n}static get i(){return o}static get minus_i(){return u}clone(){return new i(this.re(),this.im())}re(){return this._re}im(){return this._im}coords(){return[this.re(),this.im()]}static EPS=1e-8;is_zero(t){return t||(t=i.EPS),this.norm2()<t*t}eq(t,e){return this.sub(t).is_zero(e)}is_real(t){return t||(t=i.EPS),Math.abs(this.im())<t}is_imag(t){return t||(t=i.EPS),Math.abs(this.re())<t}is_inf(){return!1}to_complex(){return this}add(t){return new i(this.re()+t.re(),this.im()+t.im())}uminus(){return this.scale(-1)}sub(t){return this.add(t.uminus())}mult(t){return"number"==typeof t?this.scale(t):new i(this.re()*t.re()-this.im()*t.im(),this.re()*t.im()+this.im()*t.re())}scale(t){return new i(t*this.re(),t*this.im())}div(t){return this.mult(t.reciprocal())}norm(){return Math.sqrt(this.norm2())}norm2(){return this.re()*this.re()+this.im()*this.im()}arg(){return Math.atan2(this.im(),this.re())}sgn(){return this.scale(1/this.norm())}cnj(){return new i(this.re(),-this.im())}reciprocal(){return this.cnj().scale(1/this.norm2())}static cnj_mix(t,e){return t.cnj().mult(e).add(e.cnj().mult(t))}static scalprod(t,e){return i.cnj_mix(t,e).scale(.5).re()}}const s=new i(0,0),r=new i(1,0),n=new i(-1,0),o=new i(0,1),u=new i(0,-1);class c{constructor(t,e,s){e||(e=i.one),this.z1=t,this.z2=e,(void 0===s||s)&&this.normalize()}normalize(){this.z2.is_zero()?this.z1.is_zero()||(this.z1=i.one,this.z2=i.zero):(this.z1=this.z1.div(this.z2),this.z2=i.one)}is_valid(t){return!this.z1.is_zero(t)||!this.z2.is_zero(t)}is_zero(t){return this.z1.is_zero(t)}is_inf(t){return this.z2.is_zero(t)}static of_complex(t){return new c(t)}static of_real(t){return c.of_complex(i.of_real(t))}static of_xy(t,e){return c.of_complex(new i(t,e))}static get inf(){return h}static get zero(){return a}static get one(){return m}to_complex(){return this.z1.div(this.z2)}coords(){return this.is_inf()?null:this.to_complex().coords()}add(t){return this.z2.is_zero()&&t.z2.is_zero()?c.inf:new c(this.z1.mult(t.z2).add(t.z1.mult(this.z2)),this.z2.mult(t.z2))}uminus(){return new c(this.z1.uminus(),this.z2)}sub(t){return this.add(t.uminus())}mult(t){return this.z1.is_zero()&&t.z2.is_zero()||t.z1.is_zero()&&this.z2.is_zero()?c.one:new c(this.z1.mult(t.z1),this.z2.mult(t.z2))}reciprocal(){return new c(this.z2,this.z1)}div(t){return this.mult(t.reciprocal())}cnj(){return new c(this.z1.cnj(),this.z2.cnj())}inversion(){return this.reciprocal().cnj()}eq(t,e){return t instanceof c||(t=t.cp1()),this.is_inf()?t.is_inf():t.is_inf()?this.is_inf():this.sub(t).is_zero(e)}clone(){return new c(this.z1.clone(),this.z2.clone())}static ratio(t,e,i){return t.sub(e).div(t.sub(i))}static cross_ratio(t,e,i,s){const r=t.z1.mult(e.z2).sub(e.z1.mult(t.z2)),n=i.z1.mult(s.z2).sub(s.z1.mult(i.z2)),o=t.z1.mult(s.z2).sub(s.z1.mult(t.z2)),u=i.z1.mult(e.z2).sub(e.z1.mult(i.z2));return r.mult(n).is_zero()&&o.mult(u).is_zero()?c.one:new c(r.mult(n),o.mult(u))}vec_mult(t){return this.z1.mult(t.z1).add(this.z2.mult(t.z2))}}const h=new c(i.one,i.zero),a=c.of_real(0),m=c.of_real(1);i.prototype.cp1=function(){return c.of_complex(this)};class l{constructor(t,e,i,s){this.A=t,this.B=e,this.C=i,this.D=s}static zero(){return new l(i.zero,i.zero,i.zero,i.zero)}static eye(){return new l(i.one,i.zero,i.zero,i.one)}cnj(){return new l(this.A.cnj(),this.B.cnj(),this.C.cnj(),this.D.cnj())}transpose(){return new l(this.A,this.C,this.B,this.D)}adj(){return this.cnj().transpose()}det(){return this.A.mult(this.D).sub(this.B.mult(this.C))}inv(){return this._inv||(this._inv=new l(this.D,this.B.uminus(),this.C.uminus(),this.A).multC(this.det().reciprocal())),this._inv}qr(){if(null==this._Q||null==this._R){const t=this.C.cnj(),e=this.A.cnj(),i=Math.sqrt(t.norm2()+e.norm2()),s=e.scale(1/i),r=t.scale(1/i),n=new l(s,r,r.cnj().uminus(),s.cnj());this._Q=n.adj(),this._R=n.multM(this)}return[this._Q,this._R]}eq(t){return this.A.eq(t.A)&&this.B.eq(t.B)&&this.C.eq(t.C)&&this.D.eq(t.D)}is_hermitean(){return this.eq(this.adj())}is_zero(){return this.eq(l.zero())}multC(t){return new l(this.A.mult(t),this.B.mult(t),this.C.mult(t),this.D.mult(t))}multCP1(t,e){return new c(this.A.mult(t.z1).add(this.B.mult(t.z2)),this.C.mult(t.z1).add(this.D.mult(t.z2)),e)}multInvCP1(t){const[e,i]=this.qr(),s=e.adj().multCP1(t),r=s.z2.div(i.D),n=s.z1.sub(i.B.mult(r)).div(i.A);return new c(n,r)}multM(t){return new l(this.A.mult(t.A).add(this.B.mult(t.C)),this.A.mult(t.B).add(this.B.mult(t.D)),this.C.mult(t.A).add(this.D.mult(t.C)),this.C.mult(t.B).add(this.D.mult(t.D)))}congruence(t){return t.adj().multM(this.multM(t))}}class _{constructor(t,e,i,s){if(1==arguments.length&&arguments[0]instanceof l)this.H=arguments[0];else{if(!t.is_zero()){const r=1/t.norm();t=t.scale(r),e=e.scale(r),i=i.scale(r),s=s.scale(r)}this.H=new l(t,e,i,s)}}static mk_circle(t,e){return new _(i.one,t.uminus(),t.cnj().uminus(),t.mult(t.cnj()).sub(i.of_real(e*e)))}static mk_line(t,e){const s=e.sub(t).mult(i.i);return new _(i.zero,s,s.cnj(),i.cnj_mix(s.uminus(),t))}static mk_poincare_line(t,e){const s=i.i.mult(t.mult(e.cnj()).sub(e.mult(t.cnj()))),r=i.i.mult(e.scale(t.norm2()+1).sub(t.scale(e.norm2()+1)));return new _(s,r,r.cnj(),s)}static mk_poincare_circle(t,e){const i=t.scale(1/((1-t.norm2())*(Math.cosh(e)-1)/2+1)),s=(1-t.norm2())*Math.sinh(e)/((1-t.norm2())*(Math.cosh(e)-1)+2);return _.mk_circle(i,s)}static mk_circline3(t,e,i){return t instanceof c||(t=t.cp1()),e instanceof c||(e=e.cp1()),i instanceof c||(i=i.cp1()),d.moebius_01inf(t,e,i).inv().moebius_circline(_.x_axis())}static unit_circle(){return new _(i.one,i.zero,i.zero,i.minus_one)}static x_axis(){return new _(i.zero,i.i,i.minus_i,i.zero)}static y_axis(){return new _(i.zero,i.one,i.one,i.zero)}is_line(){return this.H.A.is_zero()}is_circle(){return!this.is_line()}circle_center(){return this.H.B.uminus().div(this.H.A)}circle_radius(){return Math.sqrt(this.H.B.mult(this.H.C).sub(this.H.A.mult(this.H.D)).div(this.H.A.mult(this.H.A)).re())}line_points(){const t=this.H.D.mult(this.H.B).uminus().div(this.H.B.mult(this.H.C).scale(2)),e=t.add(i.i.mult((this.H.B.arg()>0?this.H.B.uminus():this.H.B).sgn()));return[t,e]}static EPS=1e-12;quad_form(t){return t instanceof c||(t=t.cp1()),t.cnj().vec_mult(this.H.multCP1(t,!1)).re()}on_circline(t,e){return e||(e=_.EPS),Math.abs(this.quad_form(t))<e}in_disc(t,e){return e||(e=_.EPS),this.quad_form(t)<-e}static cross_ratio(t,e,i,s){return e instanceof c||(e=e.cp1()),t instanceof c||(t=t.cp1()),s instanceof c||(s=s.cp1()),i instanceof c||(i=i.cp1()),c.cross_ratio(t,e,i,s)}static same_circline(t,e,i,s,r){r||(r=_.EPS);const n=_.cross_ratio(t,e,i,s);return n.is_inf()||n.to_complex().is_real(r)}static same_arc(t,e,i,s,r){r||(r=_.EPS);const n=_.cross_ratio(t,e,i,s);return!n.is_inf()&&n.to_complex().is_real(r)&&n.to_complex().re()>=r}static other_arc(t,e,i,s,r){r||(r=_.EPS);const n=_.cross_ratio(t,e,i,s);return!n.is_inf()&&n.to_complex().is_real(r)&&n.to_complex().re()<-r}static between(t,e,i,s){return _.other_arc(c.inf,t,e,i,s)}static collinear(t,e,i,s){return _.same_circline(t,e,i,c.inf,s)}static same_side(t,e,i,s){return _.collinear(t,e,i,s)&&!_.between(t,i,e,s)}static h_between(t,e,i,s){return z.in_disc(e,s)&&_.other_arc(e,t,e.inversion(),i,s)}three_points(){if(!this._three_points)if(this.is_line()){const[t,e]=this.line_points();this._three_points=[t,e,t.add(e.sub(t).scale(2))]}else{const t=this.circle_center(),e=this.circle_radius();this._three_points=[t.add(i.of_real(e)),t.add(i.of_real(-e)),t.add(i.of_imag(e))]}return this._three_points}random_point(){const[t,e,i]=this.three_points().map((t=>c.of_complex(t))),s=d.moebius_01inf(t,e,i),r=Math.floor(3*Math.random());let n;return n=0==r?Math.random():1==r?1/Math.random():1-1/Math.random(),s.inv().moebius_pt(c.of_real(n))}random_point_in_disc(t){const[e,i]=this.intersect(t,!0),[s,r,n]=this.three_points().map((t=>c.of_complex(t))),o=d.moebius_01inf(s,r,n),[u,h]=[e,i].map((t=>o.moebius_pt(t).to_complex().re())).sort();let a,m=0;do{let t;if(Math.random()<.5)t=u+Math.random()*(h-u);else{const e=Math.floor(5*Math.random()),i=Math.pow(10,e)*Math.random();t=Math.random()<.5?u-i:h+i}a=o.inv().moebius_pt(c.of_real(t)),m++}while(!t.in_disc(a)&&m<100);return a}moebius_to_x_axis(){if(!this._moebius_to_x_axis){const[t,e,i]=this.three_points().map((t=>c.of_complex(t)));this._moebius_to_x_axis=d.moebius_01inf(t,e,i)}return this._moebius_to_x_axis}intersect(t,e){const s=this.moebius_to_x_axis(),r=s.moebius_circline(t),[n,o,u]=[r.H.A,r.H.B,r.H.D];let h,a;if(n.is_zero())return h=c.inf,o.is_imag()?[h,h]:(a=c.of_real(-u.re()/(2*o.re())),[h,a].map((t=>s.moebius_inv_pt(t))));{const t=o.re()*o.re()-n.re()*u.re();if(t<0){if(e){const e=Math.sqrt(-t),[r,u]=[new i(-o.re()/n.re(),+e/n.re()),new i(-o.re()/n.re(),-e/n.re())];return[r,u].map((t=>s.moebius_inv_pt(c.of_complex(t))))}return[]}{const e=Math.sqrt(t),[i,r]=[(-o.re()+e)/n.re(),(-o.re()-e)/n.re()];return[i,r].map((t=>s.moebius_inv_pt(c.of_real(t))))}}}transform(t){let e=this.three_points();return e.some((t=>isNaN(t.re())))?this:(e=e.map((e=>{const[s,r]=t(e.re(),e.im());return c.of_complex(new i(s,r))})),_.mk_circline3(...e))}normalize(){this.H.A.is_zero()?this.H.D.is_zero()?this.H=this.H.multC(this.H.B.reciprocal()):this.H=this.H.multC(this.H.D.reciprocal()):this.H=this.H.multC(this.H.A.reciprocal())}eq(t){return this.normalize(),t.normalize(),this.H.eq(t.H)}}const z=_.unit_circle();class d{constructor(t,e,i,s){1==arguments.length&&t instanceof l?this.construct(t.A,t.B,t.C,t.D):this.construct(t,e,i,s)}construct(t,e,i,s){if(t.is_zero()){const r=e.norm();t=t.scale(1/r),e=e.scale(1/r),i=i.scale(1/r),s=s.scale(1/r)}else e=e.div(t),i=i.div(t),s=s.div(t),t=t.div(t);this.M=new l(t,e,i,s)}moebius_pt(t){return t instanceof c||(t=t.cp1()),this.M.multCP1(t)}moebius_inv_pt(t){return t instanceof c||(t=t.cp1()),this.M.multInvCP1(t)}moebius_circline(t){return new _(t.H.congruence(this.M.inv()))}static id(){return new d(l.eye())}inv(){return new d(this.M.inv())}comp(t){return new d(this.M.multM(t.M))}static moebius_01inf(t,e,i){const s=e.z1.mult(i.z2).sub(i.z1.mult(e.z2)),r=e.z1.mult(t.z2).sub(t.z1.mult(e.z2));return t.z1.mult(i.z2).sub(i.z1.mult(t.z2)),new d(t.z2.mult(s),t.z1.mult(s).uminus(),i.z2.mult(r),i.z1.mult(r).uminus())}}return e})()));