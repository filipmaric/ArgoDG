!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ComplexGeom=e():t.ComplexGeom=e()}(self,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CP1:()=>c,Circline:()=>_,Complex:()=>i,ComplexMatrix2x2:()=>a,Moebius:()=>z});class i{constructor(t,e){this.re=t,this.im=e}static of_real(t){return new i(t,0)}static of_imag(t){return new i(0,t)}static get zero(){return s}static get one(){return r}static get minus_one(){return n}static get i(){return o}static get minus_i(){return u}clone(){return new i(this.re,this.im)}add(t){return new i(this.re+t.re,this.im+t.im)}mult(t){return"number"==typeof t?this.scale(number):new i(this.re*t.re-this.im*t.im,this.re*t.im+this.im*t.re)}scale(t){return new i(t*this.re,t*this.im)}uminus(){return this.scale(-1)}sub(t){return this.add(t.uminus())}norm2(){return this.re*this.re+this.im*this.im}norm(){return Math.sqrt(this.norm2())}arg(){return Math.atan2(this.im,this.re)}sgn(){return this.scale(1/this.norm())}cnj(){return new i(this.re,-this.im)}recip(){return this.cnj().scale(1/this.norm2())}div(t){return this.mult(t.recip())}static EPS=1e-8;is_zero(t){return t||(t=i.EPS),this.norm2()<t*t}is_real(){return Math.abs(this.im)<i.EPS}is_imag(){return Math.abs(this.re)<i.EPS}eq(t){return this.sub(t).is_zero()}static cnj_mix(t,e){return t.cnj().mult(e).add(e.cnj().mult(t))}static scalprod(t,e){return i.cnj_mix(other).scale(.5)}}const s=new i(0,0),r=new i(1,0),n=new i(-1,0),o=new i(0,1),u=new i(0,-1);class c{constructor(t,e){if(e||(e=i.one),this.z1=t,this.z2=e,!this.z2.is_zero()){const t=this.z2.norm();this.z1=this.z1.scale(1/t),this.z2=this.z2.scale(1/t)}}is_zero(t){return this.z1.is_zero(t)}is_inf(t){return this.z2.is_zero(t)}static of_complex(t){return new c(t)}static of_real(t){return c.of_complex(i.of_real(t))}static of_xy(t,e){return c.of_complex(new i(t,e))}static get inf(){return h}static get zero(){return m}static get one(){return l}to_complex(){return this.z1.div(this.z2)}add(t){return this.z2.is_zero()&&t.z2.is_zero()?c.inf:new c(this.z1.mult(t.z2).add(t.z1.mult(this.z2)),this.z2.mult(t.z2))}uminus(){return new c(this.z1.uminus(),this.z2)}sub(t){return this.add(t.uminus())}mult(t){return this.z1.is_zero()&&t.z2.is_zero()||t.z1.is_zero()&&this.z2.is_zero?c.one():new c(this.z1.mult(t.z1),this.z2.mult(t.z2))}reciprocal(){return new c(this.z2,this.z1)}div(t){return this.mult(t.reciprocal())}conjugate(){return new c(this.z1.cnj(),this.z2.cnj())}inversion(){return this.reciprocal().conjugate()}eq(t){return this.sub(t).is_zero()}clone(){return new c(this.z1.clone(),this.z2.clone())}static ratio(t,e,i){return t.sub(e).div(t.sub(i))}static cross_ratio(t,e,i,s){const r=t.z1.mult(e.z2).sub(e.z1.mult(t.z2)),n=i.z1.mult(s.z2).sub(s.z1.mult(i.z2)),o=t.z1.mult(s.z2).sub(s.z1.mult(t.z2)),u=i.z1.mult(e.z2).sub(e.z1.mult(i.z2));return r.mult(n).is_zero()&&o.mult(u).is_zero()?c.one():new c(r.mult(n),o.mult(u))}vec_mult(t){return this.z1.mult(t.z1).add(this.z2.mult(t.z2))}}const h=new c(i.one,i.zero),m=c.of_real(0),l=c.of_real(1);class a{constructor(t,e,i,s){this.A=t,this.B=e,this.C=i,this.D=s}static zero(){return new a(i.zero,i.zero,i.zero,i.zero)}static eye(){return new a(i.one,i.zero,i.zero,i.one)}cnj(){return new a(this.A.cnj(),this.B.cnj(),this.C.cnj(),this.D.cnj())}transpose(){return new a(this.A,this.C,this.B,this.D)}adj(){return this.cnj().transpose()}det(){return this.A.mult(this.D).sub(this.B.mult(this.C))}inv(){return this._inv||(this._inv=new a(this.D,this.B.uminus(),this.C.uminus(),this.A).multC(this.det().recip())),this._inv}qr(){if(null==this._Q||null==this._R){const t=this.C.cnj(),e=this.A.cnj(),i=Math.sqrt(t.norm2()+e.norm2()),s=e.scale(1/i),r=t.scale(1/i),n=new a(s,r,r.cnj().uminus(),s.cnj());this._Q=n.adj(),this._R=n.multM(this)}return[this._Q,this._R]}eq(t){return this.A.eq(t.A)&&this.B.eq(t.B)&&this.C.eq(t.C)&&this.D.eq(t.D)}is_hermitean(){return this.eq(this.adj())}is_zero(){return this.eq(a.zero())}multC(t){return new a(this.A.mult(t),this.B.mult(t),this.C.mult(t),this.D.mult(t))}multCP1(t){return new c(this.A.mult(t.z1).add(this.B.mult(t.z2)),this.C.mult(t.z1).add(this.D.mult(t.z2)))}multInvCP1(t){const[e,i]=this.qr(),s=e.adj().multCP1(t),r=s.z2.div(i.D),n=s.z1.sub(i.B.mult(r)).div(i.A);return new c(n,r)}multM(t){return new a(this.A.mult(t.A).add(this.B.mult(t.C)),this.A.mult(t.B).add(this.B.mult(t.D)),this.C.mult(t.A).add(this.D.mult(t.C)),this.C.mult(t.B).add(this.D.mult(t.D)))}congruence(t){return t.adj().multM(this.multM(t))}}class _{constructor(t,e,i,s){if(1==arguments.length&&arguments[0]instanceof a)this.H=arguments[0];else{if(!t.is_zero()){const r=1/t.norm();t=t.scale(r),e=e.scale(r),i=i.scale(r),s=s.scale(r)}this.H=new a(t,e,i,s)}}static mk_circle(t,e){return new _(i.one,t.uminus(),t.cnj().uminus(),t.mult(t.cnj()).sub(i.of_real(e*e)))}static mk_line(t,e){const s=e.sub(t).mult(i.i);return new _(i.zero,s,s.cnj(),i.cnj_mix(s.uminus(),t))}on_circline(t,e){return e||(e=.01),t.conjugate().vec_mult(this.H.multCP1(t)).is_zero(e)}in_disc(t){return t.conjugate().vec_mult(this.H.multCP1(t)).re<-1e-12}is_line(){return this.H.A.is_zero()}is_circle(){return!this.is_line()}circle_center(){return this.H.B.uminus().div(this.H.A)}circle_radius(){return Math.sqrt(this.H.B.mult(this.H.C).sub(this.H.A.mult(this.H.D)).div(this.H.A.mult(this.H.A)).re)}line_points(){const t=this.H.D.mult(this.H.B).uminus().div(this.H.B.mult(this.H.C).scale(2)),e=t.add(i.i.mult((this.H.B.arg()>0?this.H.B.uminus():this.H.B).sgn()));return[t,e]}static unit_circle(){return new _(i.one,i.zero,i.zero,i.minus_one)}static x_axis(){return new _(i.zero,i.i,i.minus_i,i.zero)}static y_axis(){return new _(i.zero,i.one,i.one,i.zero)}static circline3(t,e,i){return z.moebius_01inf(t,e,i).inv().moebius_circline(_.x_axis())}static same_arc(t,e,i,s){const r=c.cross_ratio(t,e,i,s);return!r.is_inf()&&r.to_complex().is_real()&&r.to_complex().re>=0}static other_arc(t,e,i,s){const r=c.cross_ratio(t,e,i,s);return!r.is_inf()&&r.to_complex().is_real()&&r.to_complex().re<0}static same_circle(t,e,i,s){const r=c.cross_ratio(t,e,i,s);return r.is_inf()||r.to_complex().is_real()}static between(t,e,i){return _.other_arc(c.inf,t,e,i)}static collinear(t,e,i){return _.same_circle(t,e,i,c.inf)}static same_side(t,e,i){return _.collinear(t,e,i)&&!_.between(t,i,e)}static h_between(t,e,i){return _.other_arc(e,t,e.inversion(),i)}three_points(){if(!this._three_points)if(this.is_line()){const[t,e]=this.line_points();this._three_points=[t,e,t.add(e.sub(t).scale(2))]}else{const t=this.circle_center(),e=this.circle_radius();this._three_points=[t.add(i.of_real(e)),t.add(i.of_real(-e)),t.add(i.of_imag(e))]}return this._three_points}random_point(){const[t,e,i]=this.three_points().map((t=>c.of_complex(t))),s=z.moebius_01inf(t,e,i),r=Math.floor(3*Math.random());let n;return n=0==r?Math.random():1==r?1/Math.random():1-1/Math.random(),s.inv().moebius_pt(c.of_real(n))}random_point_in_disc(t){const[e,i]=this.intersect(t),[s,r,n]=this.three_points().map((t=>c.of_complex(t))),o=z.moebius_01inf(s,r,n),[u,h]=[e,i].map((t=>o.moebius_pt(t).to_complex().re)).sort();let m,l=0;do{let t;if(Math.random()<.5)t=u+Math.random()*(h-u);else{const e=Math.floor(5*Math.random()),i=Math.pow(10,e)*Math.random();t=Math.random()<.5?u-i:h+i}m=o.inv().moebius_pt(c.of_real(t)),l++}while(!t.in_disc(m)||l>=100);return m}moebius_to_xaxis(){if(!this._moebius_to_xaxis){const[t,e,i]=this.three_points().map((t=>c.of_complex(t)));this._moebius_to_xaxis=z.moebius_01inf(t,e,i)}return this._moebius_to_xaxis}intersect(t){const e=this.moebius_to_xaxis(),s=e.moebius_circline(t),[r,n,o]=[s.H.A,s.H.B,s.H.D];let u,h;if(r.is_zero())return u=c.inf,n.is_imag()?[u,u]:(h=c.of_real(-o.re/(2*n.re)),[u,h].map((t=>e.moebius_inv_pt(t))));{const t=n.re*n.re-r.re*o.re;if(t<=0){const s=Math.sqrt(-t),[o,u]=[new i(-n.re/r.re,+s/r.re),new i(-n.re/r.re,-s/r.re)];return[o,u].map((t=>e.moebius_inv_pt(c.of_complex(t))))}{const i=Math.sqrt(t),[s,o]=[(-n.re+i)/r.re,(-n.re-i)/r.re];return[s,o].map((t=>e.moebius_inv_pt(c.of_real(t))))}}}transform(t){let e=this.three_points();return e.some((t=>isNaN(t.re)))?this:(e=e.map((e=>{const[s,r]=t(e.re,e.im);return c.of_complex(new i(s,r))})),_.circline3(...e))}normalize(){this.H.A.is_zero()?this.H.D.is_zero()?this.H=this.H.multC(this.H.B.recip()):this.H=this.H.multC(this.H.D.recip()):this.H=this.H.multC(this.H.A.recip())}eq(t){return this.normalize(),t.normalize(),this.H.A.eq(t.H.A)&&this.H.B.eq(t.H.B)&&this.H.C.eq(t.H.C)&&this.H.D.eq(t.H.D)}}class z{constructor(t,e,i,s){1==arguments.length&&t instanceof a?this.construct(t.A,t.B,t.C,t.D):this.construct(t,e,i,s)}construct(t,e,i,s){if(t.is_zero()){const r=e.norm();t=t.scale(1/r),e=e.scale(1/r),i=i.scale(1/r),s=s.scale(1/r)}else e=e.div(t),i=i.div(t),s=s.div(t),t=t.div(t);this.M=new a(t,e,i,s)}moebius_pt(t){return t instanceof i&&(t=CP1.of_complex(t)),this.M.multCP1(t)}moebius_inv_pt(t){return t instanceof i&&(t=CP1.of_complex(t)),this.M.multInvCP1(t)}moebius_circline(t){return new _(t.H.congruence(this.M.inv()))}static id(){return new z(a.eye())}inv(){return new z(this.M.inv())}comp(t){return new z(this.M.multM(t.M))}static moebius_01inf(t,e,i){const s=e.z1.mult(i.z2).sub(i.z1.mult(e.z2)),r=e.z1.mult(t.z2).sub(t.z1.mult(e.z2));return t.z1.mult(i.z2).sub(i.z1.mult(t.z2)),new z(t.z2.mult(s),t.z1.mult(s).uminus(),i.z2.mult(r),i.z1.mult(r).uminus())}}return e})()));